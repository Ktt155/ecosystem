# Local Development Database

We use postgres to store data we would like to persist. This README will cover how to get yourself setup and some useful tips.

### Spinning Up

```
pnpm nx run dapp-console-api:docker:services:up

or

docker-compose up -d postgres
```

### Reset

In case you ever want your db to go back to a clean state like if you're working on migrations you can tear the db down and bring it back up

```
docker-compose down postgres
```

### Enviroment Variables (backend/.env)

```
DB_HOST=0.0.0.0
DB_PORT=5432
DB_NAME=dapp-console
DB_USER=dapp-console-api@oplabs-local-web.iam
MIGRATE_DB_USER=dapp-console-api@oplabs-local-web.iam
```
### Migrations

We have three npm scripts setup to help make this easier

1. Generating schema from models. All SQL files get autogenerated based on our model code

```
pnpm nx run dapp-console-api:migrations:generate
```

2. Once you have your SQL files generated you need to apply them to the database. This command will help get those files applied to your local postgres instance

```
pnpm nx run dapp-console-api:migrations:execute
```

3. Recommended command to use it's a combination 1 & 2. It will generate the schema for you then automatically apply it to the db after

```
pnpm nx run dapp-console-api:migrations:dev
```

### Studio

Drizzle comes with something called [Drizzle Studio](https://orm.drizzle.team/drizzle-studio/overview) this is a database view that will show you everything stored in your db

To start it up run and head to https://local.drizzle.studio in your browser

```
pnpm nx run dapp-console-api:drizzle:studio
```
